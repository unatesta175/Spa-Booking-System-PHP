# Environment Configuration Setup

## Overview
All sensitive credentials (database, ToyyibPay API) are now managed through environment variables for better security and flexibility.

## Quick Start

### 1. Create the .env file
Rename `env.template` to `.env`:

**Windows Command Prompt:**
```bash
copy env.template .env
```

**Windows PowerShell:**
```powershell
Copy-Item env.template .env
```

**Linux/Mac:**
```bash
cp env.template .env
```

### 2. Your .env file should contain:

```env
# Database Configuration
DB_HOST=localhost
DB_NAME=spa_db
DB_USER=root
DB_PASS=

# ToyyibPay API Configuration
TOYYIBPAY_SECRET_KEY=m8zfj65c-2fzo-gq3b-rwhw-xvneusqy7wuy
TOYYIBPAY_CATEGORY_CODE=2n8qqo61

# Application Settings
APP_ENV=development
APP_DEBUG=true
```

### 3. Done! 
Your application will automatically use these credentials.

---

## What's Been Moved to Environment Variables

### ✅ Database Configuration
- **DB_HOST** - Database server (default: localhost)
- **DB_NAME** - Database name (spa_db)
- **DB_USER** - Database username (default: root)
- **DB_PASS** - Database password (default: empty)

### ✅ ToyyibPay API
- **TOYYIBPAY_SECRET_KEY** - Your ToyyibPay secret key
- **TOYYIBPAY_CATEGORY_CODE** - Your ToyyibPay category code

---

## Files Updated

### Database Connection Files (Now using ENV):
- ✅ `components/connect.php` (PDO connection)
- ✅ `admin/connection.php` (MySQLi connection)
- ✅ `admin/connection copy.php` (MySQLi connection backup)

### ToyyibPay Integration Files (Now using ENV):
- ✅ `getBookingInsertion.php`
- ✅ `admin/getBookingInsertion.php`
- ✅ `admin/getBookingInsertion copy.php`
- ✅ `staff/getBookingInsertion.php`
- ✅ `bookingtestold.php`

---

## How It Works

### Environment Loader
The `components/env_loader.php` automatically loads variables from `.env` file when included.

### Database Connections

**Before (Hardcoded - ❌ Insecure):**
```php
$db_name = 'mysql:host=localhost;dbname=spa_db';
$user_name = 'root';
$user_password = '';
```

**After (Environment Variables - ✅ Secure):**
```php
$db_host = env('DB_HOST', 'localhost');
$db_name_only = env('DB_NAME', 'spa_db');
$user_name = env('DB_USER', 'root');
$user_password = env('DB_PASS', '');
```

### ToyyibPay API

**Before (Hardcoded - ❌ Insecure):**
```php
'userSecretKey' => 'm8zfj65c-2fzo-gq3b-rwhw-xvneusqy7wuy',
'categoryCode' => '2n8qqo61',
```

**After (Environment Variables - ✅ Secure):**
```php
'userSecretKey' => env('TOYYIBPAY_SECRET_KEY'),
'categoryCode' => env('TOYYIBPAY_CATEGORY_CODE'),
```

---

## Security Benefits

| Feature | Before | After |
|---------|--------|-------|
| **Credentials in Code** | ❌ Hardcoded | ✅ Environment Variables |
| **Git Security** | ❌ Exposed in commits | ✅ Protected (.gitignore) |
| **Environment-Specific** | ❌ Same for all | ✅ Dev/Prod separation |
| **Easy Updates** | ❌ Change multiple files | ✅ Change one .env file |
| **Team Sharing** | ❌ Share real credentials | ✅ Share .env.example |

---

## Using Environment Variables in Your Code

### In New Files

```php
<?php
// Load environment variables
require_once 'components/env_loader.php';

// Get database credentials
$host = env('DB_HOST');
$database = env('DB_NAME');

// Get API keys
$apiKey = env('TOYYIBPAY_SECRET_KEY');
?>
```

### The env() Function

```php
// Get value, or use default if not set
$value = env('VARIABLE_NAME', 'default_value');

// Examples:
$host = env('DB_HOST', 'localhost');        // Returns 'localhost' if not set
$debug = env('APP_DEBUG', 'false');         // Returns 'false' if not set
$apiKey = env('TOYYIBPAY_SECRET_KEY');      // Returns value or null
```

---

## Different Environments

### Development (.env)
```env
DB_HOST=localhost
DB_NAME=spa_db
DB_USER=root
DB_PASS=
APP_ENV=development
APP_DEBUG=true
```

### Production (.env)
```env
DB_HOST=production-server.com
DB_NAME=spa_production_db
DB_USER=spa_user
DB_PASS=SecurePassword123!
APP_ENV=production
APP_DEBUG=false
```

---

## Troubleshooting

### ❌ Error: ".env file not found"
**Solution:** 
```bash
# Make sure you renamed env.template to .env
copy env.template .env
```

### ❌ Error: "Undefined function env()"
**Solution:** 
Make sure env_loader.php is included:
```php
require_once 'components/env_loader.php';
```

### ❌ Database connection failed
**Solution:** 
1. Check `.env` file exists in root directory
2. Verify database credentials in `.env`
3. Make sure MySQL/MariaDB is running
4. Test credentials:
   ```bash
   mysql -u root -p
   ```

### ❌ ToyyibPay not working
**Solution:** 
1. Verify keys in `.env` are correct
2. Check you have internet connection
3. Verify ToyyibPay account is active

### ❌ Changes to .env not taking effect
**Solution:** 
1. Clear PHP OpCache if enabled
2. Restart web server (XAMPP/Apache)
3. Check file permissions on .env

---

## Production Deployment Checklist

- [ ] Create fresh `.env` file on server (don't copy from development)
- [ ] Use production database credentials
- [ ] Use production API keys
- [ ] Set `APP_ENV=production`
- [ ] Set `APP_DEBUG=false`
- [ ] Set proper file permissions:
  ```bash
  chmod 600 .env
  ```
- [ ] Verify `.env` is not web-accessible
- [ ] Add `.env` to `.gitignore` (already done)
- [ ] Never commit `.env` to version control

---

## Adding New Environment Variables

### Step 1: Add to .env
```env
NEW_VARIABLE=value
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
```

### Step 2: Add to env.example.template (with placeholders)
```env
NEW_VARIABLE=your_value_here
SMTP_HOST=your_smtp_host
SMTP_PORT=587
```

### Step 3: Use in code
```php
$newValue = env('NEW_VARIABLE');
$smtpHost = env('SMTP_HOST');
$smtpPort = env('SMTP_PORT', 587); // with default
```

---

## File Structure

```
kapasbeautyspa.com/
├── .env                          # Your actual credentials (NEVER commit)
├── .env.example                  # Template (rename from env.example.template)
├── env.template                  # Template with your current values (rename to .env)
├── .gitignore                    # Ignores .env file
├── ENV_SETUP.md                  # This file
├── components/
│   ├── env_loader.php           # Loads environment variables
│   └── connect.php              # Database connection (uses ENV)
└── admin/
    ├── connection.php           # Admin database connection (uses ENV)
    └── connection copy.php      # Backup connection (uses ENV)
```

---

## Git Best Practices

### ✅ DO:
- Commit `env.example.template`
- Commit `.gitignore`
- Share `.env.example` with team
- Document required variables

### ❌ DON'T:
- Never commit `.env`
- Never commit real credentials
- Never share `.env` publicly
- Never push `.env` to GitHub

---

## Support & Documentation

For additional help:
1. Check this documentation
2. Review `components/env_loader.php` for implementation
3. Examine updated connection files for examples
4. Contact system administrator

---

## Summary

🎉 **All sensitive credentials are now environment-based!**

- ✅ Database credentials in `.env`
- ✅ ToyyibPay API keys in `.env`
- ✅ Secure from Git commits
- ✅ Easy to manage
- ✅ Production-ready

Just rename `env.template` to `.env` and you're all set!
